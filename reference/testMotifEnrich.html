<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Test motif enrichment using a background set of sequences — testMotifEnrich • motifTestR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Test motif enrichment using a background set of sequences — testMotifEnrich"><meta property="og:description" content="Test for motif enrichment within a set of sequences using a background set to
derive a NULL hypothesis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">motifTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/motifAnalysis.html">Basic Motif Analysis</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/smped/motifTestR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test motif enrichment using a background set of sequences</h1>
    <small class="dont-index">Source: <a href="https://github.com/smped/motifTestR/blob/HEAD/R/testMotifEnrich.R" class="external-link"><code>R/testMotifEnrich.R</code></a></small>
    <div class="hidden name"><code>testMotifEnrich.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Test for motif enrichment within a set of sequences using a background set to
derive a NULL hypothesis</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">testMotifEnrich</span><span class="op">(</span></span>
<span>  <span class="va">pwm</span>,</span>
<span>  <span class="va">stringset</span>,</span>
<span>  <span class="va">bg</span>,</span>
<span>  var <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"iteration"</span>, <span class="st">"quasipoisson"</span>, <span class="st">"negbinom"</span><span class="op">)</span>,</span>
<span>  sort_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>pwm</dt>
<dd><p>A Position Weight Matrix or list of PWMs</p></dd>


<dt>stringset</dt>
<dd><p>An XStringSet with equal sequence widths</p></dd>


<dt>bg</dt>
<dd><p>An XStringSet with the same sequence widths as the test XStringset</p></dd>


<dt>var</dt>
<dd><p>A column in the mcols element of bg, usually denoting an iteration
number</p></dd>


<dt>model</dt>
<dd><p>The model used for analysis</p></dd>


<dt>sort_by</dt>
<dd><p>Column to sort results by</p></dd>


<dt>mc.cores</dt>
<dd><p>Passed to <a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></p></dd>


<dt>...</dt>
<dd><p>Passed internally to <a href="https://rdrr.io/pkg/Biostrings/man/matchPWM.html" class="external-link">countPWM</a></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data.frame with columns: `sequences`, `matches`, `expected`, `enrichment`,
`Z` and `p`, with additional columns `est_bg_rate` (Poisson) or `sd_bg`,
`n_iter` and `iter_p` (Iterations).
The numbers of sequences and matches refer to the test set of sequences,
whilst expected is the expected number of matches under the Poisson or
iterative null distribution. The ratio of matches to expected is given as
`enrichment`, along with the Z score an p-value. The Z score is only
representative under the Poisson model, but is used to estimate p-values
under the iterative approach.
Under this latter approach, the sd of the matches found in the background
sequences is also given, along with the number of iterations and the p-values
from permutations testing the one-sided hypothesis hypothesis for enrichment.</p>


<p>It may also be worth noting that if producing background sequences using
<a href="makeRMRanges-methods.html">makeRMRanges</a> with `replace = TRUE` and `force_ol = TRUE`, the
iterative model corresponds to a bootstrap, given that the test sequences
will overlap the background sequences and background ranges are able to be
sampled with replacement.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function offers two alternatives for assessing the enrichment of a motif
within a set of sequences, in comparison to a background set of sequences.
Enrichment using an iterative model assumes that the background sequences
can be subset using a column in their `mcols()` element and these are
iterated through to derive a mean and sd operating under the null hypothesis.
These values are then used in a Z test to provide an estimate of motif
enrichment.
Whilst relying on few distributional assumptions and relying on the Central
Limit Theorem for the Z score, this can be a time consuming and
computationally demanding task.</p>
<p>Testing on real datasets has revealed the the background set of counts
commonly follows a Poisson distribution across multiple iterations.
As a less time-consuming and computationally-demanding approach, is also
offered as a testing strategy.
No iterations are required, but a background set of sequences which is far
greater than the sequences of interest is advised, with background sets
&gt;1000 times larger being preferred.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Load the example peaks &amp; the sequences</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ar_er_peaks"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ar_er_seq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="fu">seqinfo</span><span class="op">(</span><span class="va">ar_er_peaks</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Now sample size-matched ranges 10 times larger. In real-world analyses,</span></span></span>
<span class="r-in"><span><span class="co">## this set should be sampled as at least 1000x larger, ensuring features</span></span></span>
<span class="r-in"><span><span class="co">## are matched to your requirements. This example masks regions with known N</span></span></span>
<span class="r-in"><span><span class="co">## content, including centromeres &amp; telomeres</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hg19_mask"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">305</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bg_ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="makeRMRanges-methods.html">makeRMRanges</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">ar_er_peaks</span>, <span class="fu">GRanges</span><span class="op">(</span><span class="va">sq</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, exclude <span class="op">=</span> <span class="va">hg19_mask</span>, n_iter <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Convert ranges to DNAStringSets</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BSgenome.Hsapiens.UCSC.hg19</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BSgenome</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocIO</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: rtracklayer</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘rtracklayer’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:BiocIO’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     FileForFormat</span>
<span class="r-in"><span><span class="va">genome</span> <span class="op">&lt;-</span> <span class="va">BSgenome.Hsapiens.UCSC.hg19</span></span></span>
<span class="r-in"><span><span class="va">bg_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/getSeq.html" class="external-link">getSeq</a></span><span class="op">(</span><span class="va">genome</span>, <span class="va">bg_ranges</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test for enrichment of the ESR1 motif</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex_pwm"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">esr1</span> <span class="op">&lt;-</span> <span class="va">ex_pwm</span><span class="op">$</span><span class="va">ESR1</span></span></span>
<span class="r-in"><span><span class="fu">testMotifEnrich</span><span class="op">(</span><span class="va">esr1</span>, <span class="va">ar_er_seq</span>, <span class="va">bg_seq</span>, model <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sequences matches expected enrichment        Z            p          fdr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       229      62     12.3    5.04065 14.17111 6.735011e-24 6.735011e-24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   est_bg_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.05371179</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test all motifs</span></span></span>
<span class="r-in"><span><span class="fu">testMotifEnrich</span><span class="op">(</span><span class="va">ex_pwm</span>, <span class="va">ar_er_seq</span>, <span class="va">bg_seq</span>, model <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sequences matches expected enrichment          Z            p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FOXA1       229     334    178.4  1.8721973 11.6496310 2.693669e-25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ESR1        229      62     12.3  5.0406504 14.1711088 6.735011e-24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN281       229      63     48.9  1.2883436  2.0163443 5.287479e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN143       229       1      0.6  1.6666667  0.5163978 4.511884e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ANDR        229      61     64.9  0.9399076 -0.4841080 7.092503e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                fdr est_bg_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FOXA1 1.346835e-24 0.779039301</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ESR1  1.683753e-23 0.053711790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN281 8.812465e-02 0.213537118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN143 5.639855e-01 0.002620087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ANDR  7.092503e-01 0.283406114</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/smped" class="external-link">Stevie Pederson</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

