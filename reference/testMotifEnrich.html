<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Test motif enrichment using a background set of sequences — testMotifEnrich • motifTestR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Test motif enrichment using a background set of sequences — testMotifEnrich"><meta property="og:description" content="Test for motif enrichment within a set of sequences using a background set to
derive a NULL hypothesis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">motifTestR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/motifAnalysis.html">Basic Motif Analysis</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/smped/motifTestR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test motif enrichment using a background set of sequences</h1>
    <small class="dont-index">Source: <a href="https://github.com/smped/motifTestR/blob/HEAD/R/testMotifEnrich.R" class="external-link"><code>R/testMotifEnrich.R</code></a></small>
    <div class="hidden name"><code>testMotifEnrich.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Test for motif enrichment within a set of sequences using a background set to
derive a NULL hypothesis</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">testMotifEnrich</span><span class="op">(</span></span>
<span>  <span class="va">pwm</span>,</span>
<span>  <span class="va">stringset</span>,</span>
<span>  <span class="va">bg</span>,</span>
<span>  var <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quasipoisson"</span>, <span class="st">"hypergeometric"</span>, <span class="st">"poisson"</span>, <span class="st">"iteration"</span><span class="op">)</span>,</span>
<span>  sort_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt id="arg-pwm">pwm<a class="anchor" aria-label="anchor" href="#arg-pwm"></a></dt>
<dd><p>A Position Weight Matrix or list of PWMs</p></dd>


<dt id="arg-stringset">stringset<a class="anchor" aria-label="anchor" href="#arg-stringset"></a></dt>
<dd><p>An XStringSet with equal sequence widths</p></dd>


<dt id="arg-bg">bg<a class="anchor" aria-label="anchor" href="#arg-bg"></a></dt>
<dd><p>An XStringSet with the same sequence widths as the test XStringset</p></dd>


<dt id="arg-var">var<a class="anchor" aria-label="anchor" href="#arg-var"></a></dt>
<dd><p>A column in the mcols element of bg, usually denoting an iteration
number</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model used for analysis</p></dd>


<dt id="arg-sort-by">sort_by<a class="anchor" aria-label="anchor" href="#arg-sort-by"></a></dt>
<dd><p>Column to sort results by</p></dd>


<dt id="arg-mc-cores">mc.cores<a class="anchor" aria-label="anchor" href="#arg-mc-cores"></a></dt>
<dd><p>Passed to <a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Passed to <a href="getPwmMatches.html">getPwmMatches</a> or <a href="countPwmMatches.html">countPwmMatches</a></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data.frame with columns: <code>sequences</code>, <code>matches</code>, <code>expected</code>, <code>enrichment</code>,
and <code>p</code>, with additional columns <code>Z</code>, <code>est_bg_rate</code> (Poisson), <code>odds_ratio</code></p>


<p>(Hypergeometric) or <code>Z</code>, <code>sd_bg</code>, <code>n_iter</code> and <code>iter_p</code> (Iterations).
The numbers of sequences and matches refer to the test set of sequences,
whilst expected is the expected number of matches under the Poisson or
iterative null distribution. The ratio of matches to expected is given as
<code>enrichment</code>, along with the Z score and p-value. Whilst the Z score is only
representative under the Poisson model, it is used to directly estimate
p-values under the iterative approach.
Under this latter approach, the sd of the matches found in the background
sequences is also given, along with the number of iterations and the p-values
from permutations testing the one-sided hypothesis hypothesis for enrichment.</p>


<p>It may also be worth noting that if producing background sequences using
<a href="makeRMRanges-methods.html">makeRMRanges</a> with <code>replace = TRUE</code> and <code>force_ol = TRUE</code>, the
iterative model corresponds to a bootstrap, given that the test sequences
will overlap the background sequences and background ranges are able to be
sampled with replacement.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function offers four alternative models for assessing the enrichment of
a motif within a set of sequences, in comparison to a background set of
sequences.
Selection of the BG sequences plays an important role and, in conjunction
with the question being addressed, determines the most appropriate model to
use for testing, as described below.</p>
<p>It should also be noted that the larger the BG set of sequences, the larger
the computational burden, and results can take far longer to return. For
many millions of background sequences, this may run beyond an hour</p><div class="section">
<h3 id="descriptions-of-models-and-use-cases">Descriptions of Models and Use Cases<a class="anchor" aria-label="anchor" href="#descriptions-of-models-and-use-cases"></a></h3>

<div class="section">
<h4 id="hypergeometric-tests">Hypergeometric Tests<a class="anchor" aria-label="anchor" href="#hypergeometric-tests"></a></h4>


<p>Hypergeometric tests are best suited to the use case where the test set of
sequences represents a subset of a larger set, with a specific feature or
behaviour, whilst the BG set may be the remainder of the set without that
feature. For example, the test set may represent ChIP-Seq binding sites
where signal changes in response to treatment, whilst the BG set represents
the sites where no changed signal was observed. Testing is one-sided, for
enrichment of motifs within the test set.</p>
<p>Due to these relatively smaller sized datasets, setting
model = "hypergeometric", will generally return results quickly</p>
</div>

<div class="section">
<h4 id="poisson-tests">Poisson Tests<a class="anchor" aria-label="anchor" href="#poisson-tests"></a></h4>


<p>This approach requires a set of background sequences which should be much
larger than the test set of sequences.
The parameters for a Poisson model are estimated in a per-sequence manner on
the set of BG sequences, and the observed rate of motif-matches within the
test set is then tested using <a href="https://rdrr.io/r/stats/poisson.test.html" class="external-link">poisson.test</a>.</p>
<p>This approach assumes that all matches follow a Poisson distribution, which
is often true, but data can also be overdispersed. Given that this model can
also return results relatively quickly, is it primarily suitable for data
exploration, but not for final results.</p>
</div>

<div class="section">
<h4 id="quasi-poisson-test">Quasi-Poisson Test<a class="anchor" aria-label="anchor" href="#quasi-poisson-test"></a></h4>


<p>The quasipoisson model allows for over-dispersion and will return more
conservative results than using the standard Poisson model.
Under the method currently implemented here, BG sequences should be divided
into blocks (i.e. iterations), identical in size to the test set of sequences.
Model parameters are estimated per iteration across the BG set of sequences,
with the rate of matches in the test being compared against these.</p>
<p>It is expected that the BG set will matched for the features of interest and
chosen using <a href="makeRMRanges-methods.html">makeRMRanges</a> with a large number of iterations, e.g.
n_iter = 1000.
Due to this parameterisation, quasipoisson approaches can be computationally
time-consuming, as this is effectively an iterative approach.</p>
</div>

<div class="section">
<h4 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a></h4>


<p>Setting the model as "iteration" performs a non-parametric analysis, with
the exception of returning Z-scores under the Central Limit Theorem.
Mean and SD of matches is found for each iteration, and used to return Z
scores, with p-values returned from both a Z-test and from comparing
observed values directly to sampled values obtained from the BG sequences.
Sampled values are calculated directly and as such, are limited in precision.</p>
<p>As for the QuasiPoisson model, a very large number of iterations is expected
to be used, to ensure the CLT holds, again making this a computationally
demanding test.
Each iteration/block is expected to be identically-sized to the test set,
and matched for any features as appropriate using <code><a href="makeRMRanges-methods.html">makeRMRanges()</a></code>.</p>
</div>


</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="makeRMRanges-methods.html">makeRMRanges()</a></code>, <code><a href="getPwmMatches.html">getPwmMatches()</a></code>, <code><a href="countPwmMatches.html">countPwmMatches()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Load the example peaks &amp; the sequences</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ar_er_peaks"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ar_er_seq"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="fu">seqinfo</span><span class="op">(</span><span class="va">ar_er_peaks</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Now sample size-matched ranges 10 times larger. In real-world analyses,</span></span></span>
<span class="r-in"><span><span class="co">## this set should be sampled as at least 1000x larger, ensuring features</span></span></span>
<span class="r-in"><span><span class="co">## are matched to your requirements. This example masks regions with known N</span></span></span>
<span class="r-in"><span><span class="co">## content, including centromeres &amp; telomeres</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hg19_mask"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">305</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bg_ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="makeRMRanges-methods.html">makeRMRanges</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">ar_er_peaks</span>, <span class="fu">GRanges</span><span class="op">(</span><span class="va">sq</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, exclude <span class="op">=</span> <span class="va">hg19_mask</span>, n_iter <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Convert ranges to DNAStringSets</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BSgenome.Hsapiens.UCSC.hg19</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BSgenome</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocIO</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: rtracklayer</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: 'rtracklayer'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from 'package:BiocIO':</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     FileForFormat</span>
<span class="r-in"><span><span class="va">genome</span> <span class="op">&lt;-</span> <span class="va">BSgenome.Hsapiens.UCSC.hg19</span></span></span>
<span class="r-in"><span><span class="va">bg_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/getSeq.html" class="external-link">getSeq</a></span><span class="op">(</span><span class="va">genome</span>, <span class="va">bg_ranges</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test for enrichment of the ESR1 motif</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ex_pwm"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">esr1</span> <span class="op">&lt;-</span> <span class="va">ex_pwm</span><span class="op">$</span><span class="va">ESR1</span></span></span>
<span class="r-in"><span><span class="fu">testMotifEnrich</span><span class="op">(</span><span class="va">esr1</span>, <span class="va">ar_er_seq</span>, <span class="va">bg_seq</span>, model <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sequences matches expected enrichment        Z            p          fdr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       229      62     12.3    5.04065 14.17111 6.735011e-24 6.735011e-24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   est_bg_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.05371179</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Test all motifs</span></span></span>
<span class="r-in"><span><span class="fu">testMotifEnrich</span><span class="op">(</span><span class="va">ex_pwm</span>, <span class="va">ar_er_seq</span>, <span class="va">bg_seq</span>, model <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sequences matches expected enrichment          Z            p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FOXA1       229     334    178.4  1.8721973 11.6496310 2.693669e-25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ESR1        229      62     12.3  5.0406504 14.1711088 6.735011e-24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN281       229      63     48.9  1.2883436  2.0163443 5.287479e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN143       229       1      0.6  1.6666667  0.5163978 4.511884e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ANDR        229      61     64.9  0.9399076 -0.4841080 7.092503e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                fdr est_bg_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FOXA1 1.346835e-24 0.779039301</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ESR1  1.683753e-23 0.053711790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN281 8.812465e-02 0.213537118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZN143 5.639855e-01 0.002620087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ANDR  7.092503e-01 0.283406114</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/smped" class="external-link">Stevie Pederson</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

